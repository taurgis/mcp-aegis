description: "Array Pattern Examples - Length, Elements, Contains"
tests:
  # Array Length Pattern
  - it: "should validate tools array has exactly one element"
    request:
      jsonrpc: "2.0"
      id: "array-length-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-length-1"
        result:
          tools: "match:arrayLength:1"  # Exactly 1 tool

  # Array Length for Content Array
  - it: "should validate content array has single element"
    request:
      jsonrpc: "2.0"
      id: "array-length-2"
      method: "tools/call"
      params:
        name: "read_file"
        arguments:
          path: "../shared-test-data/hello.txt"
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-length-2"
        result:
          content: "match:arrayLength:1"  # Single content element
          isError: false

  # Array Elements Pattern - All tools must match structure
  - it: "should validate all tools have required structure"
    request:
      jsonrpc: "2.0"
      id: "array-elements-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-elements-1"
        result:
          tools:
            match:arrayElements:
              name: "match:type:string"
              description: "match:type:string"
              inputSchema: "match:type:object"

  # Array Elements Pattern - Content structure
  - it: "should validate all content elements have type and text"
    request:
      jsonrpc: "2.0"
      id: "array-elements-2"
      method: "tools/call"
      params:
        name: "read_file"
        arguments:
          path: "../shared-test-data/hello.txt"
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-elements-2"
        result:
          content:
            match:arrayElements:
              type: "match:type:string"
              text: "match:type:string"
          isError: false

  # Array Elements Pattern - Schema properties structure
  - it: "should validate schema properties array structure"
    request:
      jsonrpc: "2.0"
      id: "array-elements-3"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-elements-3"
        result:
          tools:
            - name: "read_file"
              description: "match:type:string"
              inputSchema:
                type: "object"
                properties: "match:type:object"
                required:
                  match:arrayElements: "match:type:string"  # All required fields are strings

  # Array Contains Pattern using Field Extraction
  - it: "should validate tools contain read_file tool by name"
    request:
      jsonrpc: "2.0"
      id: "array-contains-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-contains-1"
        result:
          match:extractField: "tools.*.name"
          value: "match:arrayContains:read_file"

  # Array Contains Pattern for Required Fields
  - it: "should validate required array contains path field"
    request:
      jsonrpc: "2.0"
      id: "array-contains-2"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-contains-2"
        result:
          tools:
            - name: "read_file"
              description: "match:type:string"
              inputSchema:
                type: "object"
                properties: "match:type:object"
                required: "match:arrayContains:path"  # Required array contains "path"

  # Multiple Array Validations
  - it: "should validate multiple array properties simultaneously"
    request:
      jsonrpc: "2.0"
      id: "multi-array-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "multi-array-1"
        result:
          tools: "match:arrayLength:1"  # Exactly 1 tool
          match:extractField: "tools.*.name"
          value: "match:arrayContains:read_file"  # Contains read_file

  # Array with String Pattern Matching
  - it: "should validate array elements with string patterns"
    request:
      jsonrpc: "2.0"
      id: "array-string-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-string-1"
        result:
          tools:
            match:arrayElements:
              name: "match:endsWith:_file"     # Tool name ends with "_file"
              description: "match:contains:file"  # Description contains "file"

  # Array Pattern for Error Cases
  - it: "should validate error content array structure"
    request:
      jsonrpc: "2.0"
      id: "array-error-1"
      method: "tools/call"
      params:
        name: "read_file"
        arguments:
          path: "../shared-test-data/nonexistent.txt"
    expect:
      response:
        jsonrpc: "2.0"
        id: "array-error-1"
        result:
          content: "match:arrayLength:1"  # Single error message
          isError: true

  # Complex Array Element Validation
  - it: "should validate complex nested array structure"
    request:
      jsonrpc: "2.0"
      id: "complex-array-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "complex-array-1"
        result:
          tools:
            match:arrayElements:
              name: "match:type:string"
              description: "match:type:string"
              inputSchema:
                type: "match:type:string"
                properties:
                  path:
                    type: "match:type:string"
                required: "match:arrayLength:1"  # One required field

  # Empty Array Validation
  - it: "should handle empty arrays correctly"
    request:
      jsonrpc: "2.0"
      id: "empty-array-1"
      method: "tools/call"
      params:
        name: "read_file" 
        arguments:
          path: "../shared-test-data/empty.txt"
    expect:
      response:
        jsonrpc: "2.0"
        id: "empty-array-1"
        result:
          content: "match:arrayLength:1"  # Still returns array with empty content
          isError: false

  # Array Count Pattern Alternative
  - it: "should validate using count pattern for arrays"
    request:
      jsonrpc: "2.0"
      id: "count-array-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "count-array-1"
        result:
          tools: "match:count:1"  # Alternative to arrayLength for counting

  # === COMPREHENSIVE KEY VALIDATION EXAMPLES ===
  # These examples demonstrate how to validate that array elements have specific keys
  # and that those keys match certain patterns or types

  # Basic key presence validation
  - it: "should validate that all tools have required keys with correct types"
    request:
      jsonrpc: "2.0"
      id: "basic-keys-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "basic-keys-1"
        result:
          tools:
            match:arrayElements:
              name: "match:type:string"          # Must have 'name' key of type string
              description: "match:type:string"   # Must have 'description' key of type string
              inputSchema: "match:type:object"   # Must have 'inputSchema' key of type object

  # Advanced pattern-based key validation  
  - it: "should validate key content patterns"
    request:
      jsonrpc: "2.0"
      id: "pattern-keys-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "pattern-keys-1"
        result:
          tools:
            match:arrayElements:
              name: "match:regex:^[a-z][a-z0-9_]*$"  # snake_case names only
              description: "match:regex:.{5,}"        # Min 5 characters
              inputSchema: "match:type:object"

  # Nested object structure validation
  - it: "should validate nested inputSchema structure"
    request:
      jsonrpc: "2.0"
      id: "nested-keys-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "nested-keys-1"
        result:
          tools:
            match:arrayElements:
              name: "match:type:string"
              description: "match:type:string"
              inputSchema:
                type: "match:type:string"        # inputSchema.type must be string
                properties: "match:type:object"  # inputSchema.properties must be object
                required: "match:type:array"     # inputSchema.required must be array

  # Mixed exact and pattern matching
  - it: "should support mixed validation types"
    request:
      jsonrpc: "2.0"
      id: "mixed-keys-1"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "mixed-keys-1"
        result:
          tools:
            match:arrayElements:
              name: "read_file"                    # Exact match
              description: "match:contains:file"   # Must contain "file"
              inputSchema: "match:type:object"     # Type validation
