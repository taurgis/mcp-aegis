description: "Failing Date Pattern Tests - Demonstrates Date Validation Failures"
tests:
  # These tests should fail to demonstrate MCP Conductor's date pattern error detection
  # Note: Uses data-patterns-server for realistic date data

  # Test 1: Date valid failure - invalid date
  - it: "should fail when date is not valid"
    request:
      jsonrpc: "2.0"
      id: "date-fail-1"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-1"
        result:
          match:partial:
            invalidDate: "match:dateValid"  # ❌ FAIL: invalidDate is "not-a-date", not valid

  # Test 2: Date after failure - date is before expected
  - it: "should fail when date is not after expected date"
    request:
      jsonrpc: "2.0"
      id: "date-fail-2"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-2"
        result:
          match:partial:
            dateString: "match:dateAfter:2025-01-01"  # ❌ FAIL: dateString 2023-06-15 before 2025-01-01

  # Test 3: Date before failure - date is after expected
  - it: "should fail when date is not before expected date"
    request:
      jsonrpc: "2.0"
      id: "date-fail-3"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-3"
        result:
          match:partial:
            dateString: "match:dateBefore:2020-01-01"  # ❌ FAIL: dateString 2023-06-15 after 2020-01-01

  # Test 4: Date between failure - date outside range
  - it: "should fail when date is not between expected range"
    request:
      jsonrpc: "2.0"
      id: "date-fail-4"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-4"
        result:
          match:partial:
            dateString: "match:dateBetween:2020-01-01:2022-12-31"  # ❌ FAIL: 2023-06-15 outside 2020-2022 range

  # Test 5: Date age failure - date is older than expected
  - it: "should fail when date is older than expected age"
    request:
      jsonrpc: "2.0"
      id: "date-fail-5"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-5"
        result:
          match:partial:
            dateString: "match:dateAge:1d"  # ❌ FAIL: dateString 2023-06-15 much older than 1 day

  # Test 6: Date equals failure - dates don't match
  - it: "should fail when dates don't equal"
    request:
      jsonrpc: "2.0"
      id: "date-fail-6"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-6"
        result:
          match:partial:
            dateString: "match:dateEquals:2025-12-25"  # ❌ FAIL: dateString 2023-06-15 != 2025-12-25

  # Test 7: Date format failure - wrong format
  - it: "should fail when date format doesn't match expected"
    request:
      jsonrpc: "2.0"
      id: "date-fail-7"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-7"
        result:
          match:partial:
            usFormat: "match:dateFormat:iso"  # ❌ FAIL: usFormat is "6/15/2023", not ISO format

  # Test 8: ISO date format failure
  - it: "should fail when expecting ISO date but getting different format"
    request:
      jsonrpc: "2.0"
      id: "date-fail-8"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-8"
        result:
          match:partial:
            dateString: "match:dateFormat:us-date"  # ❌ FAIL: dateString is "2023-06-15" (ISO), not US format

  # Test 9: Timestamp format failure
  - it: "should fail when expecting timestamp but getting date string"
    request:
      jsonrpc: "2.0"
      id: "date-fail-9"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-9"
        result:
          match:partial:
            isoDate: "match:dateFormat:timestamp"  # ❌ FAIL: isoDate is ISO string, not numeric timestamp

  # Test 10: Wrong type for date validation
  - it: "should fail when applying date pattern to non-date value"
    request:
      jsonrpc: "2.0"
      id: "date-fail-10"
      method: "tools/list"
      params: {}
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-10"
        result:
          tools:
            - name: "match:dateValid"  # ❌ FAIL: name is "read_file", not a date

  # Test 11: Date age with wrong duration
  - it: "should fail when date age doesn't match expected duration"
    request:
      jsonrpc: "2.0"
      id: "date-fail-11"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-11"
        result:
          match:partial:
            dateString: "match:dateAge:1h"  # ❌ FAIL: dateString 2023-06-15 not within 1 hour

  # Test 12: Complex date validation failure with current timestamp
  - it: "should fail when current timestamp is not in future"
    request:
      jsonrpc: "2.0"
      id: "date-fail-12"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"  # use mixed so isoDate field exists
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-12"
        result:
          match:partial:
            isoDate: "match:dateAfter:2030-01-01"  # ❌ FAIL: isoDate (current 2025 date) before 2030

  # Test 13: Multiple date validation failures
  - it: "should fail with multiple date validation errors"
    request:
      jsonrpc: "2.0"
      id: "date-fail-13"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-13"
        result:
          match:partial:
            invalidDate: "match:dateValid"         # ❌ FAIL: invalid date
            nullDate: "match:dateAfter:2020-01-01" # ❌ FAIL: null is not a date
            emptyDate: "match:dateBefore:2025-01-01" # ❌ FAIL: empty string is not a date

  # Added Edge Cases
  # Test 14: iso-date format expected but time provided
  - it: "should fail when expecting iso-date but got full ISO timestamp"
    request:
      jsonrpc: "2.0"
      id: "date-fail-14"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-14"
        result:
          match:partial:
            isoDate: "match:dateFormat:iso-date" # ❌ FAIL: isoDate includes time component

  # Test 15: iso-time expected but date provided
  - it: "should fail when expecting iso-time but got date"
    request:
      jsonrpc: "2.0"
      id: "date-fail-15"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-15"
        result:
          match:partial:
            dateString: "match:dateFormat:iso-time" # ❌ FAIL: dateString is a date not a time

  # Test 16: eu-date expected but US format not provided (still fails to show token present)
  - it: "should fail when expecting eu-date but got ISO"
    request:
      jsonrpc: "2.0"
      id: "date-fail-16"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-16"
        result:
          match:partial:
            dateString: "match:dateFormat:eu-date" # ❌ FAIL: dateString is ISO 2023-06-15

  # Test 17: malformed dateAge duration
  - it: "should fail with malformed dateAge duration"
    request:
      jsonrpc: "2.0"
      id: "date-fail-17"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-17"
        result:
          match:partial:
            dateString: "match:dateAge:10x" # ❌ FAIL: invalid duration token '10x'

  # Test 18: malformed dateBetween missing end date
  - it: "should fail with malformed dateBetween pattern"
    request:
      jsonrpc: "2.0"
      id: "date-fail-18"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-18"
        result:
          match:partial:
            dateString: "match:dateBetween:2020-01-01" # ❌ FAIL: missing second bound

  # Test 19: invalid dateAfter reference date
  - it: "should fail with invalid dateAfter reference"
    request:
      jsonrpc: "2.0"
      id: "date-fail-19"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-19"
        result:
          match:partial:
            dateString: "match:dateAfter:not-a-date" # ❌ FAIL: invalid reference date

  # Test 20: invalid dateEquals expected value
  - it: "should fail with invalid dateEquals expected value"
    request:
      jsonrpc: "2.0"
      id: "date-fail-20"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-20"
        result:
          match:partial:
            dateString: "match:dateEquals:not-a-date" # ❌ FAIL: invalid expected date

  # Test 21: unknown dateFormat token
  - it: "should fail with unknown dateFormat token"
    request:
      jsonrpc: "2.0"
      id: "date-fail-21"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-21"
        result:
          match:partial:
            isoDate: "match:dateFormat:unknown-format" # ❌ FAIL: format token not implemented

  # Test 22: reversed dateBetween range (start after end)
  - it: "should fail when dateBetween range reversed"
    request:
      jsonrpc: "2.0"
      id: "date-fail-22"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-22"
        result:
          match:partial:
            dateString: "match:dateBetween:2025-12-31:2020-01-01" # ❌ FAIL: start > end

  # Additional tests to directly exercise malformed/reversed pattern analyzers using existing isoDate field
  # Test 23: malformed dateAge invalid unit on existing field
  - it: "should fail with malformed dateAge duration on isoDate"
    request:
      jsonrpc: "2.0"
      id: "date-fail-23"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-23"
        result:
          match:partial:
            isoDate: "match:dateAge:5x" # ❌ FAIL: malformed duration (invalid unit x)

  # Test 24: malformed dateBetween (single bound) on existing field
  - it: "should fail with malformed dateBetween single bound on isoDate"
    request:
      jsonrpc: "2.0"
      id: "date-fail-24"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-24"
        result:
          match:partial:
            isoDate: "match:dateBetween:2030-01-01" # ❌ FAIL: malformed (missing second bound)

  # Test 25: reversed dateBetween bounds on existing field
  - it: "should fail with reversed dateBetween bounds on isoDate"
    request:
      jsonrpc: "2.0"
      id: "date-fail-25"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-25"
        result:
          match:partial:
            isoDate: "match:dateBetween:2030-01-01:2020-01-01" # ❌ FAIL: start > end (reversed)

  # Test 26: invalid dateEquals expected value on existing field
  - it: "should fail with invalid dateEquals expected value on isoDate"
    request:
      jsonrpc: "2.0"
      id: "date-fail-26"
      method: "tools/call"
      params:
        name: "get_timestamp_data"
        arguments:
          format: "mixed"
    expect:
      response:
        jsonrpc: "2.0"
        id: "date-fail-26"
        result:
          match:partial:
            isoDate: "match:dateEquals:not-a-date" # ❌ FAIL: invalid expected comparison value
